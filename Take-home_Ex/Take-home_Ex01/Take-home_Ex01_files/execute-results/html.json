{
  "hash": "44127c23f267a819eee2db097f83e1e6",
  "result": {
    "markdown": "---\ntitle: \"Creating Data Visualisation Beyond Default\"\ntitle-block-banner: \"#F0FFFF\"\nauthor: \"Wang Yaling\"\ndate: \"Jan 14, 2024\"\ndate-modified: last-modified\ndate-format: medium\nexcute:\n  eval: true\n  echo: true\n  warning: false\neditor: visual\nabstract: \n    This document explores the 2022 Programme for International Student Assessment (PISA) data using appropriate Exploratory Data Analysis (EDA) methods and ggplot2 functions. The primary goal is to practice creating data visualizations beyond default parameters.\n---\n\n\n# 1. Loading packages and reading data\n\nThe data set under analysis is derived from [PISA](https://www.oecd.org/pisa/data/2022database/) data ([Student questionnaire data file](https://webfs.oecd.org/pisa2022/STU_QQQ_SAS.zip)). The original data set is a SAS data set, and it needs to be read using `read.sas()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(ggrepel, patchwork, ggthemes, hrbrthemes, tidyverse, haven) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstu_qqq <- read_sas(\"data/cy08msp_stu_qqq.sas7bdat\")\ndimensions <- dim(stu_qqq)\ncat(\"Rows:\", dimensions[1], \" Columns:\", dimensions[2])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 613744  Columns: 1279\n```\n:::\n:::\n\n\nThe original data set has a total of 613,744 rows and 1,279 columns.\n\n# 2. Filter SG student records\n\nIn this practice, only Singapore students will be visually analysed. Therefore, the first step is to filter SG student records.\n\n\n::: {.cell}\n\n```{.r .cell-code .code-overflow-scroll  code-fold=\"true\" code-summary=\"Show the code\"}\nstu_qqq_SG <- stu_qqq %>% \n  filter(CNT == \"SGP\")\nwrite_rds(stu_qqq_SG, \"data/stu_qqq_SG.rds\")\nstu_qqq_SG <- read_rds(\"data/stu_qqq_SG.rds\")\ndimensions_SG <- dim(stu_qqq_SG)\ncat(\"Rows:\", dimensions_SG[1], \" Columns:\", dimensions_SG[2])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 6606  Columns: 1279\n```\n:::\n:::\n\n\nThe filtered records has 6,606 rows and 1,279 columns, which means there is a number of 6,606 SG students involved in this questionnaire, and each of them has 1,279 data related. The filtered data set was saved as **stu_qqq_SG.rds**.\n\n# 3. Student Performance\n\n## 3.1 Mean of Plausible Values\n\nThe **stu_qqq_SG.rds**. includes 10 **Plausible Values** (PV) for **Math**, **Reading**, and **Science** each. To assess the performance of SG students in each subject, the average PV for each subject will be calculated as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code .code-overflow-scroll  code-fold=\"true\" code-summary=\"Show the code\"}\nAvg_PVMath <- rowMeans(stu_qqq_SG[, c(\"PV1MATH\", \"PV2MATH\", \"PV3MATH\", \"PV4MATH\", \"PV5MATH\", \"PV6MATH\", \"PV7MATH\", \"PV8MATH\", \"PV9MATH\", \"PV10MATH\")])\nAvg_PVRead <- rowMeans(stu_qqq_SG[, c(\"PV1READ\", \"PV2READ\", \"PV3READ\", \"PV4READ\", \"PV5READ\", \"PV6READ\", \"PV7READ\", \"PV8READ\", \"PV9READ\", \"PV10READ\")])\nAvg_PVScience <- rowMeans(stu_qqq_SG[, c(\"PV1SCIE\", \"PV2SCIE\", \"PV3SCIE\", \"PV4SCIE\", \"PV5SCIE\", \"PV6SCIE\", \"PV7SCIE\", \"PV8SCIE\", \"PV9SCIE\", \"PV10SCIE\")])\n\nPV_Avg <- cbind(stu_qqq_SG[\"CNTSTUID\"], Avg_PVMath, Avg_PVRead, Avg_PVScience)\nwrite_rds(PV_Avg, \"data/stu_qqq_SG_PV_Avg.rds\")\n\nhead(PV_Avg)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  CNTSTUID Avg_PVMath Avg_PVRead Avg_PVScience\n1 70200001   605.2533   667.4296      639.7873\n2 70200002   689.9528   627.6078      672.0703\n3 70200003   676.7768   582.9252      660.0384\n4 70200004   401.0528   361.3969      343.6425\n5 70200005   436.1151   475.6763      479.2390\n6 70200006   518.1055   431.4652      476.0031\n```\n:::\n:::\n\n\nEach SG student's **Avg_PVMath**, **Avg_PVRead**, and **Avg_PVScience** values reflect their proficiency in Math, Reading, and Science, respectively. In the table above, the first row shows the performance scores of Math, Reading and Science for student \"70200001\" is 605.2533, 667.4296, 639.7873, respectively.\n\nRefer to the [instruction](https://www.oecd.org/pisa/data/httpoecdorgpisadatabase-instructions.htm) and the [PISA Data Analysis Manual](https://read.oecd-ilibrary.org/education/pisa-data-analysis-manual-spss-second-edition_9789264056275-en#page1) to learn more about Plausible Value.\n\n## 3.2 Distribution of Performance\n\n### 3.2.1 Analyse\n\n#### 3.2.1.1 One Subject\n\nFirst, let's see the frequency of each subject's performance scores by histogram.\n\n**Histogram**\n\n::: panel-tabset\n## Math\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = PV_Avg, aes(x=Avg_PVMath)) +\n  geom_histogram(bins=20, boundary = 100, color=\"grey25\", fill=\"grey90\") +\n  geom_vline(aes(xintercept = mean(PV_Avg$Avg_PVScience), linetype=\"Mean\", color=\"Mean\"), size=1) +\n  geom_vline(aes(xintercept = median(PV_Avg$Avg_PVScience), linetype=\"Median\", color=\"Median\"), size=1) +\n  scale_linetype_manual(name = \"Statistic\", values = c(Mean = \"dashed\", Median = \"dashed\")) +\n  scale_color_manual(name = \"Statistic\", values = c(Mean = \"blue\", Median = \"red\")) +\n  ggtitle(\"Distribution of SG Students' Science Performance\") +\n  labs(color = \"Statistic\") + \n  theme_test() +\n  theme(\n    legend.position = c(0.9, 0.7),\n    legend.text = element_text(size = 10),\n    legend.key.size = unit(5, \"mm\")\n  )\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n## Reading\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = PV_Avg, aes(x=Avg_PVRead)) +\n  geom_histogram(bins=20, boundary = 100, color=\"grey25\", fill=\"grey90\") +\n  geom_vline(aes(xintercept = mean(PV_Avg$Avg_PVScience), linetype=\"Mean\", color=\"Mean\"), size=1) +\n  geom_vline(aes(xintercept = median(PV_Avg$Avg_PVScience), linetype=\"Median\", color=\"Median\"), size=1) +\n  scale_linetype_manual(name = \"Statistic\", values = c(Mean = \"dashed\", Median = \"dashed\")) +\n  scale_color_manual(name = \"Statistic\", values = c(Mean = \"blue\", Median = \"red\")) +\n  ggtitle(\"Distribution of SG Students' Science Performance\") +\n  labs(color = \"Statistic\") + \n  theme_test() +\n  theme(\n    legend.position = c(0.9, 0.7),\n    legend.text = element_text(size = 10),\n    legend.key.size = unit(5, \"mm\")\n  )\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n## Science\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = PV_Avg, aes(x=Avg_PVScience)) +\n  geom_histogram(bins=20, boundary = 100, color=\"grey25\", fill=\"grey90\") +\n  geom_vline(aes(xintercept = mean(PV_Avg$Avg_PVScience), linetype=\"Mean\", color=\"Mean\"), size=1) +\n  geom_vline(aes(xintercept = median(PV_Avg$Avg_PVScience), linetype=\"Median\", color=\"Median\"), size=1) +\n  scale_linetype_manual(name = \"Statistic\", values = c(Mean = \"dashed\", Median = \"dashed\")) +\n  scale_color_manual(name = \"Statistic\", values = c(Mean = \"blue\", Median = \"red\")) +\n  ggtitle(\"Distribution of SG Students' Science Performance\") +\n  labs(color = \"Statistic\") + \n  theme_test() +\n  theme(\n    legend.position = c(0.9, 0.7),\n    legend.text = element_text(size = 10),\n    legend.key.size = unit(5, \"mm\")\n  )\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n:::\n\nThe three histograms depicted above show a **left-skewed** distribution, indicating that many values are concentrated near the lower end of the range, with infrequent higher values. This is reflected in a mean score lower than the median. This may be due to some students with extremely low scores pulling down the mean, which we can see in the following box plot.\n\nNext, let's use box plot to explore more.\n\n**Boxplot**\n\n::: panel-tabset\n## plot\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n## code\n\n\n::: {.cell}\n\n```{.r .cell-code}\nPV_Avg_tidy <- PV_Avg %>%\n  pivot_longer(cols = c(Avg_PVMath, Avg_PVRead, Avg_PVScience), names_to = \"Subject\", values_to = \"Score\")\n\nmax_values <- PV_Avg_tidy %>% group_by(Subject) %>% summarise(max_value = max(Score))\n\nggplot(PV_Avg_tidy, aes(x = Subject, y = Score)) +\n  geom_boxplot() +\n  facet_grid(. ~ Subject, scales = \"free_x\") +\n  geom_hline(data = max_values, aes(yintercept = max_value, linetype = \"Max\"), color = \"blue\", show.legend = FALSE) +\n  geom_text(data = max_values, aes(x = Subject, y = max_value, label = sprintf(\"Max: %.2f\", max_value)), size = 3, vjust = -0.5, hjust = 0.5, color = \"blue\") +\n  geom_hline(aes(yintercept = median(Score), linetype = \"Median\"), color = \"red\",show.legend = FALSE) +\n  coord_cartesian(ylim = range(PV_Avg_tidy$Score)) \n```\n:::\n\n:::\n\nThe three box plots reveal:\n\n1.  Some students scored extremely low, especially in Reading, followed by Science and Math.\n\n2.  Median scores follow the order: Math \\> Science \\> Reading.\n\n3.  Maximum scores follow the order: Math \\> Science \\> Reading.\n\n4.  Over 75% of students scored above 500 in Math and 75% of students scored above 500 in Science, while less than 75% scored above 500 in Reading.\n\nNext, by using density curve, we can see more of the distribution and central tendency of the performance scores.\n\n**Density curve**\n\n::: panel-tabset\n## plot\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n## code\n\n\n::: {.cell}\n\n```{.r .cell-code}\n  peak_math <- density(PV_Avg$Avg_PVMath)$x[which.max(density(PV_Avg$Avg_PVMath)$y)]\n  peak_read <- density(PV_Avg$Avg_PVRead)$x[which.max(density(PV_Avg$Avg_PVRead)$y)]\n  peak_science <- density(PV_Avg$Avg_PVScience)$x[which.max(density(PV_Avg$Avg_PVScience)$y)]\n  \nggplot(data = PV_Avg) +\n  geom_density(aes(x = Avg_PVMath, color = \"Math\"), fill = \"blue\", alpha = 0.2) +\n  geom_density(aes(x = Avg_PVRead, color = \"Reading\"), fill = \"green\", alpha = 0.2) +\n  geom_density(aes(x = Avg_PVScience, color = \"Science\"), fill = \"red\", alpha = 0.2) +\n  ggtitle(\"Density of SG Students' Performance\") +\n  labs(x = \"Average of Plausible Value\") +\n  geom_vline(aes(xintercept = peak_math, color = \"Math\"), linetype = \"dashed\", size = 1) +\n  geom_vline(aes(xintercept = peak_read, color = \"Reading\"), linetype = \"dashed\", size = 1) +\n  geom_vline(aes(xintercept = peak_science, color = \"Science\"), linetype = \"dashed\", size = 1) +\n  geom_text(aes(x = peak_math, y = 0, label = sprintf(\"Math: %.2f\", peak_math)), \n            vjust = - 0.5, hjust = 0.2, color = \"blue\", size = 3) +\n  geom_text(aes(x = peak_read, y = 0, label = sprintf(\"Reading: %.2f\", peak_read)), \n            vjust = - 3.5, hjust = 0.2, color = \"green\", size = 3) +\n  geom_text(aes(x = peak_science, y = 0, label = sprintf(\"Science: %.2f\", peak_science)),\n            vjust = - 8, hjust = 0.2, color = \"red\", size = 3) +\n  scale_color_manual(values = c(\"Math\" = \"blue\", \"Reading\" = \"green\", \"Science\" = \"red\"), name = \"Subject\") +\n  theme_test() +\n  theme(\n    legend.position = c(0.9, 0.8),\n    legend.text = element_text(size = 8),\n    legend.key.size = unit(5, \"mm\")\n  )\n```\n:::\n\n:::\n\nThe three density curves above reveal:\n\n1.  The performance for all three subjects show a tendency towards a leftward skew in their distributions.\n\n2.  Math scores are centered around 600, Science scores around 580, and Reading scores around 560.\n\nLast, let's present the distribution by violin plots.\n\n**Violin plot**\n\n::: panel-tabset\n## plot\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n## code\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = PV_Avg) +\n  geom_violin(aes(x = \"Math\", y = Avg_PVMath, fill = \"Math\"), position = \"dodge\", alpha = 0.5) +\n  geom_violin(aes(x = \"Reading\", y = Avg_PVRead, fill = \"Reading\"), position = \"dodge\", alpha = 0.5) +\n  geom_violin(aes(x = \"Science\", y = Avg_PVScience, fill = \"Science\"), position = \"dodge\", alpha = 0.5) +\n  ggtitle(\"Violin Plot of SG Students' Performance\") +\n  labs(fill = \"Subject\", x = \"Subject\", y = \"Plausible Value\") +\n  theme_test() +\n  theme(\n    legend.position = c(0.9, 0.9),\n    legend.text = element_text(size = 8),\n    legend.key.size = unit(4, \"mm\")\n  )\n```\n:::\n\n:::\n\nThe three violin plots reveal:\n\n1.  Scores for all three subjects are mainly concentrated between 500-700.\n\n2.  Math scores are centered above 600, while Reading and Science scores are primarily distributed in the 500-600 range. Moreover, the peak value for Science scores is higher than the peak value for Reading scores.\n\n3.  The performance distribution for all three subjects is left-skewed, with the lower half of the violin plots being longer.\n\n#### 3.2.1.2 Two Subjects\n\n::: panel-tabset\n## Math vs Reading\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data=PV_Avg, \n       aes(x= Avg_PVMath, \n           y= Avg_PVRead)) +\n  geom_point() +\n  geom_smooth(formula = y ~ x, method=lm, color = \"lightblue\") +\n  geom_text(aes(x = max(Avg_PVMath), y = max(Avg_PVRead),\n                label = paste(\"y = \", round(coef(lm(Avg_PVRead ~ Avg_PVMath))[2], 2), \"x + \", round(coef(lm(Avg_PVRead ~ Avg_PVMath))[1], 2))),\n            hjust = 1.5, vjust = 1, color = \"pink\", size = 5) +\n  ggtitle(\"Math vs Reading\") +\n  labs(x=\"Math Score\", y=\"Reading Score\") +\n  theme_dark()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n## Math vs Science\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data=PV_Avg, \n       aes(x= Avg_PVMath, \n           y= Avg_PVScience)) +\n  geom_point() +\n  geom_smooth(formula = y ~ x, method=lm, color = \"lightblue\") +\n  geom_text(aes(x = max(Avg_PVMath), y = max(Avg_PVScience),\n                label = paste(\"y = \", round(coef(lm(Avg_PVScience ~ Avg_PVMath))[2], 2), \"x + \", round(coef(lm(Avg_PVScience ~ Avg_PVMath))[1], 2))),\n            hjust = 1.5, vjust = 1, color = \"pink\", size = 5) +\n  ggtitle(\"Math vs Science\") +\n  labs(x=\"Math Score\", y=\"Science Score\") +\n  theme_dark()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n## Math vs Reading\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data=PV_Avg, \n       aes(x= Avg_PVScience, \n           y= Avg_PVRead)) +\n  geom_point() +\n  geom_smooth(formula = y ~ x, method=lm, color = \"lightblue\") +\n  geom_text(aes(x = max(Avg_PVScience), y = max(Avg_PVRead),\n                label = paste(\"y = \", round(coef(lm(Avg_PVRead ~ Avg_PVScience))[2], 2), \"x + \", round(coef(lm(Avg_PVRead ~ Avg_PVScience))[1], 2))),\n            hjust = 1.5, vjust = 1, color = \"pink\", size = 5) +\n  ggtitle(\"Science vs Reading\") +\n  labs(x=\"Science Score\", y=\"Reading Score\") +\n  theme_dark()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n:::\n\nFrom the three scatter plots above and their respective fit curves, it can be observed that the scores of the three subjects are positively correlated in pairs. As the scores in Math increase, the corresponding scores in Reading and Science also increase, with Science scores being higher. Similarly, when Reading scores are higher, Science scores also tend to be higher.\n\n#### 3.2.1.3 Three Subjects\n\nFrom the three colored scatter plots below, we can observe a positive trend: as the scores of any two subjects increase, the score of the third subject also tends to rise. This is visually represented by lighter colors and higher values towards the upper right corner, indicating superior performance. Conversely, when the scores of any two subjects decrease, the score of the third subject tends to decrease as well, reflected in darker colors and lower values towards the lower left corner. This pattern suggests a positive correlation among the performance scores of the three subjects, highlighting that higher scores in one subject are associated with higher scores in the others.\n\n::: panel-tabset\n## Math vs Reading with Science\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = PV_Avg, \n       aes(x = Avg_PVMath, \n           y = Avg_PVRead, \n           color = Avg_PVScience)) +\n  geom_point() +\n  ggtitle(\"Math vs Reading with Science\") +\n  labs(x = \"Math Score\", y = \"Reading Score\", color = \"Science Score\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n## Math vs Science with Reading\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = PV_Avg, \n       aes(x = Avg_PVMath, \n           y = Avg_PVScience, \n           color = Avg_PVRead)) +\n  geom_point() +\n  ggtitle(\"Math vs Science with Reading\") +\n  labs(x = \"Math Score\", y = \"Science Score\", color = \"Reading Score\") +\n  scale_color_continuous(\"Reading Score\", breaks = seq(200, 800, by = 100), \n                          low = \"red\", high = \"pink\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n## Reading vs Science with Math\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = PV_Avg, \n       aes(x = Avg_PVRead, \n           y = Avg_PVScience, \n           color = Avg_PVMath)) +\n  geom_point() +\n  ggtitle(\"Reading vs Science with Math\") +\n  labs(x = \"Reading Score\", y = \"Science Score\", color = \"Math Score\") +\n  scale_color_continuous(\"Math Score\", breaks = seq(200, 800, by = 100), \n                          low = \"darkgreen\", high = \"lightgreen\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n:::\n\n## 3.3 Summary\n\n# 4. Performance Influencers\n\n## 4.1 Gender\n\nThe code chunk below is for creating another data set which includes SG students' **gender** and performance scores in **Math**, **Read** and **Science**. The new data set was saved as **stu_qqq_SG_PV_Avg_gender.rds**.\n\n\n::: {.cell}\n\n```{.r .cell-code .code-overflow-scroll  code-fold=\"true\" code-summary=\"Show the code\"}\nPV_Avg_gender <- cbind(PV_Avg, gender = stu_qqq_SG$ST004D01T)\nwrite_rds(PV_Avg_gender, \"data/stu_qqq_SG_PV_Avg_gender.rds\")\nhead(PV_Avg_gender)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  CNTSTUID Avg_PVMath Avg_PVRead Avg_PVScience gender\n1 70200001   605.2533   667.4296      639.7873      1\n2 70200002   689.9528   627.6078      672.0703      2\n3 70200003   676.7768   582.9252      660.0384      2\n4 70200004   401.0528   361.3969      343.6425      2\n5 70200005   436.1151   475.6763      479.2390      1\n6 70200006   518.1055   431.4652      476.0031      1\n```\n:::\n:::\n\n\n::: callout-tip\nIn the original data set, the column \"ST004D01T\" records student's gender, \"1\" represent female, \"2\" represent male. ([Computer-Based Student Questionnaire for Pisa 2022 - Main Survey Version](https://www.oecd.org/pisa/data/2022database/CY8_202111_QST_MS_STQ_CBA_NoNotes.pdf))\n:::\n\n### 4.1.1 Analyse\n\nlet's see how gender influence student's performance on the three subjects by histogram.\n\n**Histogram**\n\n::: panel-tabset\n## Math\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = PV_Avg_gender, \n       aes(x = Avg_PVMath, \n           fill = as.factor(gender))) +\n  geom_histogram(bins = 20, \n                 color = \"black\") +\n  scale_fill_manual(values = c(\"1\" = \"pink\", \"2\" = \"lightblue\"), \n                    breaks = c(\"1\", \"2\"), \n                    labels = c(\"Female\", \"Male\")) +\n  labs(fill = \"Gender\", x = \"Math Score\") +\n  ggtitle(\"Performance of Math by Gender\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\n## Reading\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = PV_Avg_gender, \n       aes(x = Avg_PVRead, \n           fill = as.factor(gender))) +\n  geom_histogram(bins = 20, \n                 color = \"black\") +\n  scale_fill_manual(values = c(\"1\" = \"pink\", \"2\" = \"lightblue\"), \n                    breaks = c(\"1\", \"2\"), \n                    labels = c(\"Female\", \"Male\")) +\n  labs(fill = \"Gender\", x = \"Reading Score\") +\n  ggtitle(\"Performance of Reading by Gender\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\n## Science\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = PV_Avg_gender, \n       aes(x = Avg_PVScience, \n           fill = as.factor(gender))) +\n  geom_histogram(bins = 20, \n                 color = \"black\") +\n  scale_fill_manual(values = c(\"1\" = \"pink\", \"2\" = \"lightblue\"), \n                    breaks = c(\"1\", \"2\"), \n                    labels = c(\"Female\", \"Male\")) +\n  labs(fill = \"Gender\", x = \"Science Score\") +\n  ggtitle(\"Performance of Science by Gender\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n:::\n\nFrom the three histograms above:\n\n1.  Overall, male and female performances are fairly balanced in all three subjects, with similar proportions across most score ranges, except for scores above 700.\n\n2.  In the high-score range (above 700), particularly near 800, by looking at the proportion, there are more males excelling in Math and Science, while females excel in Reading.\n\nNext, let's explore more by density curve.\n\n**Density curve**\n\n::: panel-tabset\n## Math\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = PV_Avg_gender, \n       aes(x = Avg_PVMath, \n           color = as.factor(gender))) +\n  geom_density(alpha = 0, size = 1) +\n  scale_color_manual(values = c(\"1\" = \"pink\", \"2\" = \"lightblue\"), \n                     breaks = c(\"1\", \"2\"), \n                     labels = c(\"Female\", \"Male\")) +\n  labs(color = \"Gender\", x = \"Math Score\") +\n  ggtitle(\"Density Plot of Math Performance by Gender\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\n## Reading\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = PV_Avg_gender, \n       aes(x = Avg_PVRead, \n           color = as.factor(gender))) +\n  geom_density(alpha = 0, size = 1) +\n  scale_color_manual(values = c(\"1\" = \"pink\", \"2\" = \"lightblue\"), \n                     breaks = c(\"1\", \"2\"), \n                     labels = c(\"Female\", \"Male\")) +\n  labs(color = \"Gender\", x = \"Reading Score\") +\n  ggtitle(\"Density Plot of Reading Performance by Gender\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n\n## Science\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = PV_Avg_gender, \n       aes(x = Avg_PVScience, \n           color = as.factor(gender))) +\n  geom_density(alpha = 0, size = 1) +\n  scale_color_manual(values = c(\"1\" = \"pink\", \"2\" = \"lightblue\"), \n                     breaks = c(\"1\", \"2\"), \n                     labels = c(\"Female\", \"Male\")) +\n  labs(color = \"Gender\", x = \"Science Score\") +\n  ggtitle(\"Density Plot of Science Performance by Gender\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n:::\n\nFrom the above three density curves, we can observe the following:\n\n1.  Both male and female students exhibit a left-skewed trend in their performance scores across the three subjects.\n\n2.  In terms of Math performance, female scores are concentrated around 600, while male scores are concentrated around 650, indicating that the majority of male students perform better in mathematics than the majority of female students.\n\n3.  Regarding Reading performance, both male and female scores are concentrated around 550-600, approximately at 580. In the lower score range (\\<500), there are more male students, represented by the area under the curve below 500 being larger for males than females. Similarly, in the higher score range (\\>600), there are more female students, represented by the area under the curve above 600 being larger for females than males. This suggests that the majority of female students outperform male students in reading.\n\n4.  In Science performance, female scores are concentrated below 600 (around 580), while male scores are concentrated above 600 (around 610). This indicates that the majority of male students perform better in science than the majority of female students. In the higher score range (\\>600), there are more male students, represented by the area under the curve above 600 being larger for males than females.\n\n### 4.1.2 Summary\n\n## 4.2 School\n\nThe code chunk below is for creating another data set which includes SG **schools** and performance scores in **Math**, **Read** and **Science**. The new data set was saved as **stu_qqq_SG_PV_Avg_school.rds**.\n\n\n::: {.cell}\n\n```{.r .cell-code .code-overflow-scroll  code-fold=\"true\" code-summary=\"Show the code\"}\nPV_Avg_school <- cbind(PV_Avg, school = stu_qqq_SG$CNTSCHID)\nwrite_rds(PV_Avg_school, \"data/stu_qqq_SG_PV_Avg_school.rds\")\nhead(PV_Avg_school)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  CNTSTUID Avg_PVMath Avg_PVRead Avg_PVScience   school\n1 70200001   605.2533   667.4296      639.7873 70200052\n2 70200002   689.9528   627.6078      672.0703 70200134\n3 70200003   676.7768   582.9252      660.0384 70200112\n4 70200004   401.0528   361.3969      343.6425 70200004\n5 70200005   436.1151   475.6763      479.2390 70200152\n6 70200006   518.1055   431.4652      476.0031 70200043\n```\n:::\n:::\n\n\nThe code chunk below is for the calculation of the total number of schools surveyed in the questionnaire, as well as the number of respondents for each school.\n\n\n::: {.cell}\n\n```{.r .cell-code .code-overflow-scroll  code-fold=\"true\" code-summary=\"Show the code\"}\nschool_counts <- PV_Avg_school %>%\n  group_by(school) %>%\n  summarise(STUCount = n_distinct(CNTSTUID))\n\nschool_counts\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 164 × 2\n     school STUCount\n      <dbl>    <int>\n 1 70200001       55\n 2 70200002       38\n 3 70200003       36\n 4 70200004       56\n 5 70200005       38\n 6 70200006       36\n 7 70200007       38\n 8 70200008       38\n 9 70200009       36\n10 70200010       36\n# ℹ 154 more rows\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code .code-overflow-scroll  code-fold=\"true\" code-summary=\"Show the code\"}\ntotal_schools <- n_distinct(school_counts$school)\ncat(\"There are\", total_schools, \"SG schools in this data set.\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nThere are 164 SG schools in this data set.\n```\n:::\n:::\n\n\nThe code chunk below calculates the mean scores for Math, Reading and Science for all surveyed students in each school. This process provides representative scores for three subjects for each school.\n\n\n::: {.cell}\n\n```{.r .cell-code .code-overflow-scroll  code-fold=\"true\" code-summary=\"Show the code\"}\nPV_Avg_school_group <- PV_Avg_school %>%\n  group_by(school) %>%\n  summarise(\n    School_Avg_PVMath = mean(Avg_PVMath),\n    School_Avg_PVRead = mean(Avg_PVRead),\n    School_Avg_PVScience = mean(Avg_PVScience)\n  )\n\n# Print the first few rows of the new data set\nwrite_rds(PV_Avg_school_group, \"data/stu_qqq_SG_PV_Avg_school_group.rds\")\nhead(PV_Avg_school_group)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 4\n    school School_Avg_PVMath School_Avg_PVRead School_Avg_PVScience\n     <dbl>             <dbl>             <dbl>                <dbl>\n1 70200001              725.              653.                 698.\n2 70200002              535.              507.                 534.\n3 70200003              740.              665.                 714.\n4 70200004              510.              480.                 494.\n5 70200005              547.              516.                 529.\n6 70200006              487.              468.                 477.\n```\n:::\n:::\n\n\n### 4.2.1 Analyse\n\nLet's see the schools performance by dot plot.\n\n**Dot plot**\n\n::: panel-tabset\n## School vs Math\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = PV_Avg_school_group, aes(x = school, y = School_Avg_PVMath)) +\n  geom_point() +\n  geom_smooth(formula = y~x, method = lm) +\n  ggtitle(\"Dot Plot of Math Score by School\") +\n  labs(y = \"Math Score\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-31-1.png){width=672}\n:::\n:::\n\n\n## School vs Reading\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = PV_Avg_school_group, aes(x = school, y = School_Avg_PVRead)) +\n  geom_point() +\n  geom_smooth(formula = y~x, method = lm) +\n  ggtitle(\"Dot Plot of Reading Score by School\") +\n  labs(y = \"Reading Score\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-32-1.png){width=672}\n:::\n:::\n\n\n## School vs Science\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = PV_Avg_school_group, aes(x = school, y = School_Avg_PVScience)) +\n  geom_point() +\n  geom_smooth(formula = y~x, method = lm) +\n  ggtitle(\"Dot Plot of Science Score by School\") +\n  labs(y = \"Science Score\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-33-1.png){width=672}\n:::\n:::\n\n:::\n\nFrom the three dot plots above, we can get:\n\n1.  In Math, most schools have students scoring between 500-600, with the next common range being 600-700. Two schools scored above 700, while two schools had notably lower scores around 400.\n\n2.  In Reading, majority of schools show scores between 450-550, followed by 550-650. Five schools scored above 650, but two schools had notably low scores, falling below 400, with one even below 350.\n\n3.  In Science, In most schools, students scored between 500-600, followed by 600-700. Two schools scored high (around 700), while two schools scored low (under 400).\n\n4.  The three plots' shapes are similar, indicating consistent performance across subjects. Schools either perform well, average, or poorly in all subjects. Few schools show better reading performance than in math and science.\n\n5.  Two schools consistently excel (upper left), while two consistently perform poorly (lower right) across all subjects.\n\n6.  Though subtle, there's a slight downward trend in the fit curve, suggesting that as school codes increase, scores may potentially decrease.\n\n### 4.2.2 Summary\n\n## 4.3 Socioeconomic status\n\nThe code chunk below is for creating another data set which includes SG **socioeconomic status** and performance scores in **Math**, **Read** and **Science**. The new data set was saved as **stu_qqq_SG_PV_Avg_status.rds**.\n\n::: {.cell}\n\n```{.r .cell-code .code-overflow-scroll  code-fold=\"true\" code-summary=\"Show the code\"}\nPV_Avg_status <- cbind(PV_Avg, status = stu_qqq_SG$ST259Q01JA)\nwrite_rds(PV_Avg_status, \"data/stu_qqq_SG_PV_Avg_status.rds\")\nhead(PV_Avg_status)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  CNTSTUID Avg_PVMath Avg_PVRead Avg_PVScience status\n1 70200001   605.2533   667.4296      639.7873     NA\n2 70200002   689.9528   627.6078      672.0703     NA\n3 70200003   676.7768   582.9252      660.0384     NA\n4 70200004   401.0528   361.3969      343.6425     NA\n5 70200005   436.1151   475.6763      479.2390     NA\n6 70200006   518.1055   431.4652      476.0031     NA\n```\n:::\n:::\n\n\n### 4.3.1 Analyse\n\n### 4.3.2 Summary\n\n# Reference\n\n[PISA Data Analysis Manual: SPSS, Second Edition](https://read.oecd-ilibrary.org/education/pisa-data-analysis-manual-spss-second-edition_9789264056275-en#page1)\n\n[How to prepare and analyse the PISA database](https://www.oecd.org/pisa/data/httpoecdorgpisadatabase-instructions.htm)\n\n[How to Interpret Histograms](https://www.labxchange.org/library/items/lb:LabXchange:10d3270e:html:1)\n\n[How to Interpret Violin Charts](https://www.labxchange.org/library/items/lb:LabXchange:46f64d7a:html:1)\n\n[Computer-Based Student Questionnaire for Pisa 2022 - Main Survey Version](https://www.oecd.org/pisa/data/2022database/CY8_202111_QST_MS_STQ_CBA_NoNotes.pdf)\n",
    "supporting": [
      "Take-home_Ex01_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}